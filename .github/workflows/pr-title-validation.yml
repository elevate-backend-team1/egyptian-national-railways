name: PR Title Validation

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-title:
    runs-on: ubuntu-latest

    steps:
      - name: Validate PR Title
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "PR Title: $PR_TITLE"

          # Allowed PR types: fix, release, feature, hotfix, build, test
          # Scope: JIRA Ticket formats: PROJECT-123, JIRA-123, ANYUPPER-123
          # Format: type(scope): TICKET-task-name

          REGEX="^(fix|release|feature|hotfix|build|test)\(([A-Z]+-[0-9]+|JIRA-[0-9]+)\): [A-Za-z0-9 ._-]+$"

          if [[ ! "$PR_TITLE" =~ $REGEX ]]; then
            echo "❌ Invalid PR title format!"
            echo "Title must match: type(scope): {TICKET}-{task-name}"
            echo ""
            echo "Allowed types: fix, release, feature, hotfix, build, test"
            echo "Allowed scope formats: PROJECTID-123, JIRA-123"
            echo ""
            echo "Example: fix(ENR-2): Setup Authentication"
            exit 1
          fi

          echo "✅ PR title is valid!"
